# MallEco API æ•°æ®åº“ç®¡ç†æ¨¡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

MallEco API æ•°æ®åº“ç®¡ç†æ¨¡å—æä¾›äº†ä¸€å¥—å®Œæ•´çš„æ•°æ®åº“ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š
- ğŸ”§ **æ•°æ®åº“åˆå§‹åŒ–ä¸éƒ¨ç½²**
- ğŸ“Š **å¥åº·æ£€æŸ¥ä¸ç›‘æ§**
- ğŸ”„ **ç‰ˆæœ¬ç®¡ç†ä¸å‡çº§**
- âš¡ **æ€§èƒ½ä¼˜åŒ–ä¸è°ƒä¼˜**
- ğŸ’¾ **æ•°æ®è¿ç§»ä¸å¤‡ä»½**

## ğŸ“ æ–‡ä»¶ç»“æ„

```
DB/
â”œâ”€â”€ index.js                    # ç»Ÿä¸€ç®¡ç†å…¥å£ï¼ˆæ¨èä½¿ç”¨ï¼‰
â”œâ”€â”€ database-manager.js         # æ ¸å¿ƒæ•°æ®åº“ç®¡ç†å™¨
â”œâ”€â”€ create-missing-tables.sql   # ç¼ºå¤±è¡¨åˆ›å»ºè„šæœ¬
â”œâ”€â”€ optimize-indexes-tables.sql # ç´¢å¼•ä¼˜åŒ–è„šæœ¬
â”œâ”€â”€ database-migration-script.sql # æ•°æ®è¿ç§»è„šæœ¬
â”œâ”€â”€ database-performance-tuning.sql # æ€§èƒ½è°ƒä¼˜è„šæœ¬
â”œâ”€â”€ create-order-sharding.sql   # è®¢å•åˆ†è¡¨è„šæœ¬
â””â”€â”€ README.md                   # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 14.0+
- MySQL 5.7+ æˆ– MariaDB 10.2+
- æ•°æ®åº“è¿æ¥é…ç½®ï¼ˆä½äº `config/.env`ï¼‰

### æ•°æ®åº“é…ç½®

åœ¨ `config/.env` æ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“è¿æ¥ï¼š

```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=your_password
DB_NAME=malleco
DB_CHARSET=utf8mb4
```

### é¦–æ¬¡éƒ¨ç½²

#### 1. æ–°é¡¹ç›®åˆå§‹åŒ–ï¼ˆæ¨èï¼‰

```bash
# è¿›å…¥DBç›®å½•
cd MallEcoAPI/DB

# æ‰§è¡Œæ–°é¡¹ç›®åˆå§‹åŒ–
node index.js setup
```

#### 2. æ‰‹åŠ¨åˆå§‹åŒ–ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

```bash
# ä½¿ç”¨æ ¸å¿ƒç®¡ç†å™¨è¿›è¡Œåˆå§‹åŒ–
node database-manager.js init
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### æ•°æ®åº“ç®¡ç†å‘½ä»¤

#### ç»Ÿä¸€å…¥å£å‘½ä»¤ï¼ˆæ¨èï¼‰

| å‘½ä»¤ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `node index.js setup` | æ–°é¡¹ç›®åˆå§‹åŒ– | é¦–æ¬¡éƒ¨ç½²ã€å…¨æ–°ç¯å¢ƒ |
| `node index.js health` | å¥åº·æ£€æŸ¥ | æ—¥å¸¸ç›‘æ§ã€æ•…éšœæ’æŸ¥ |
| `node index.js upgrade` | ç‰ˆæœ¬å‡çº§ | åŠŸèƒ½æ›´æ–°ã€æ•°æ®åº“å˜æ›´ |
| `node index.js status` | æŸ¥çœ‹çŠ¶æ€ | å¿«é€ŸæŸ¥çœ‹æ•°æ®åº“çŠ¶æ€ |
| `node index.js tables` | æŸ¥çœ‹è¡¨åˆ—è¡¨ | æŸ¥çœ‹æ‰€æœ‰æ•°æ®è¡¨ |
| `node index.js history` | ç‰ˆæœ¬å†å² | æŸ¥çœ‹å‡çº§è®°å½• |
| `node index.js optimize` | æ€§èƒ½ä¼˜åŒ– | å®šæœŸç»´æŠ¤ã€æ€§èƒ½è°ƒä¼˜ |

#### æ ¸å¿ƒç®¡ç†å™¨å‘½ä»¤

```bash
# åŸºç¡€ç®¡ç†
node database-manager.js init      # åˆå§‹åŒ–
node database-manager.js update    # æ›´æ–°ï¼ˆä»…åˆ›å»ºç¼ºå¤±è¡¨ï¼‰
node database-manager.js health    # å¥åº·æ£€æŸ¥

# ç‰ˆæœ¬ç®¡ç†
node database-manager.js version   # ç‰ˆæœ¬å‡çº§
node database-manager.js current   # æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
node database-manager.js history   # ç‰ˆæœ¬å†å²

# è¾…åŠ©åŠŸèƒ½
node database-manager.js tables    # è¡¨åˆ—è¡¨
node database-manager.js optimize  # æ€§èƒ½ä¼˜åŒ–
```

## ğŸ“Š å¥åº·æ£€æŸ¥

### åŸºç¡€å¥åº·æ£€æŸ¥

```bash
node index.js health
```

**æ£€æŸ¥é¡¹ç›®ï¼š**
- âœ… æ•°æ®åº“è¿æ¥çŠ¶æ€
- âœ… å…³é”®è¡¨å­˜åœ¨æ€§æ£€æŸ¥ï¼ˆmall_members, mall_product, mall_orderï¼‰
- âœ… è¡¨ç»“æ„å®Œæ•´æ€§æ£€æŸ¥
- âœ… ç‰ˆæœ¬ç®¡ç†è¡¨çŠ¶æ€

### å¢å¼ºå¥åº·æ£€æŸ¥

```bash
node database-manager.js health
```

**é¢å¤–æ£€æŸ¥é¡¹ç›®ï¼š**
- ğŸ“Š å½“å‰æ•°æ®åº“ç‰ˆæœ¬
- ğŸ”„ ç‰ˆæœ¬æ›´æ–°å»ºè®®
- âš ï¸ ç¼ºå¤±è¡¨è­¦å‘Š
- ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡æ£€æŸ¥

## ğŸ”„ ç‰ˆæœ¬ç®¡ç†

### å½“å‰ç‰ˆæœ¬ç³»ç»Ÿ

| ç‰ˆæœ¬å· | æè¿° | æ–°å¢åŠŸèƒ½ |
|--------|------|----------|
| 1.0.0 | åˆå§‹ç‰ˆæœ¬ | åŸºç¡€è¡¨ç»“æ„ã€ä¼šå‘˜ã€å•†å“ã€è®¢å• |
| 1.1.0 | æ€§èƒ½ä¼˜åŒ–ç‰ˆ | ç´¢å¼•ä¼˜åŒ–ã€è¡¨ç»“æ„ä¼˜åŒ– |

### ç‰ˆæœ¬å‡çº§æµç¨‹

```bash
# æ£€æŸ¥å½“å‰ç‰ˆæœ¬
node index.js status

# æ‰§è¡Œç‰ˆæœ¬å‡çº§
node index.js upgrade

# æŸ¥çœ‹å‡çº§å†å²
node index.js history
```

### è‡ªåŠ¨ç‰ˆæœ¬æ£€æµ‹

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹éœ€è¦åº”ç”¨çš„ç‰ˆæœ¬ï¼Œæ”¯æŒï¼š
- ğŸ†• **å…¨æ–°æ•°æ®åº“**ï¼šè‡ªåŠ¨åº”ç”¨æ‰€æœ‰ç‰ˆæœ¬
- ğŸ”„ **ç‰ˆæœ¬å‡çº§**ï¼šä»…åº”ç”¨æ–°ç‰ˆæœ¬
- ğŸ” **è¡¨ç»“æ„æ£€æµ‹**ï¼šé€šè¿‡è¡¨ç»“æ„æ™ºèƒ½åˆ¤æ–­éœ€è¦ç‰ˆæœ¬

## âš¡ æ€§èƒ½ä¼˜åŒ–

### å®šæœŸä¼˜åŒ–

```bash
# æ‰§è¡Œæ€§èƒ½ä¼˜åŒ–
node index.js optimize
```

**ä¼˜åŒ–é¡¹ç›®ï¼š**
- ğŸ” ç´¢å¼•åˆ†æä¸ä¼˜åŒ–
- ğŸ“Š è¡¨ç»“æ„ä¼˜åŒ–
- âš¡ æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- ğŸ’¾ å­˜å‚¨ä¼˜åŒ–

### æ€§èƒ½è°ƒä¼˜è„šæœ¬

```bash
# æ‰‹åŠ¨æ‰§è¡Œæ€§èƒ½è°ƒä¼˜SQL
mysql -u root -p < database-performance-tuning.sql
```

## ğŸ’¾ æ•°æ®è¿ç§»

### è¿ç§»è„šæœ¬

```bash
# æ‰§è¡Œæ•°æ®è¿ç§»
mysql -u root -p < database-migration-script.sql
```

**è¿ç§»åŠŸèƒ½ï¼š**
- ğŸ”„ æ•°æ®è¡¨é‡å‘½åï¼ˆli_å‰ç¼€ â†’ mall_å‰ç¼€ï¼‰
- ğŸ“Š æ•°æ®è½¬æ¢ä¸æ¸…ç†
- ğŸ›¡ï¸ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

### åˆ†è¡¨ç­–ç•¥

```bash
# åˆ›å»ºè®¢å•åˆ†è¡¨
mysql -u root -p < create-order-sharding.sql
```

**åˆ†è¡¨ç‰¹æ€§ï¼š**
- ğŸ“… æŒ‰æ—¶é—´åˆ†è¡¨ï¼ˆæœˆåº¦/å¹´åº¦ï¼‰
- ğŸ”¢ æŒ‰IDèŒƒå›´åˆ†è¡¨
- âš¡ æŸ¥è¯¢è·¯ç”±ä¼˜åŒ–

## ğŸ› ï¸ ç»´æŠ¤æŒ‡å—

### æ—¥å¸¸ç»´æŠ¤

#### 1. æ¯æ—¥æ£€æŸ¥

```bash
# æ¯æ—¥å¥åº·æ£€æŸ¥
node index.js health
```

#### 2. æ¯å‘¨ç»´æŠ¤

```bash
# æ€§èƒ½ä¼˜åŒ–
node index.js optimize

# å¤‡ä»½æ£€æŸ¥ï¼ˆå»ºè®®é…ç½®å®šæ—¶ä»»åŠ¡ï¼‰
```

#### 3. æ¯æœˆç»´æŠ¤

```bash
# ç‰ˆæœ¬æ£€æŸ¥ä¸å‡çº§
node index.js upgrade

# æ•°æ®æ¸…ç†ä¸å½’æ¡£
```

### æ•…éšœæ’æŸ¥

#### å¸¸è§é—®é¢˜è§£å†³

**é—®é¢˜1ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
cat config/.env | grep DB_

# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -h localhost -u root -p
```

**é—®é¢˜2ï¼šè¡¨åˆ›å»ºå¤±è´¥**
```bash
# æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨å†²çª
node database-manager.js tables

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
node database-manager.js init --verbose
```

**é—®é¢˜3ï¼šç‰ˆæœ¬å‡çº§å¤±è´¥**
```bash
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬çŠ¶æ€
node database-manager.js current

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
node database-manager.js version
```

### å¤‡ä»½ä¸æ¢å¤

#### å¤‡ä»½ç­–ç•¥

```bash
# å®Œæ•´å¤‡ä»½
mysqldump -u root -p malleco > backup_$(date +%Y%m%d).sql

# ä»…å¤‡ä»½æ•°æ®ï¼ˆä¸å«è¡¨ç»“æ„ï¼‰
mysqldump -u root -p --no-create-info malleco > data_backup_$(date +%Y%m%d).sql
```

#### æ¢å¤æ“ä½œ

```bash
# æ¢å¤å®Œæ•´å¤‡ä»½
mysql -u root -p malleco < backup_20231211.sql

# æ¢å¤æ•°æ®ï¼ˆè¡¨ç»“æ„éœ€å…ˆå­˜åœ¨ï¼‰
mysql -u root -p malleco < data_backup_20231211.sql
```

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰ç‰ˆæœ¬ç®¡ç†

åœ¨ `database-manager.js` ä¸­ä¿®æ”¹ç‰ˆæœ¬é…ç½®ï¼š

```javascript
this.versions = [
  {
    version: '1.0.0',
    description: 'åˆå§‹ç‰ˆæœ¬ - åŸºç¡€è¡¨ç»“æ„',
    sqlFile: 'create-missing-tables.sql',
    requiredTables: ['mall_members', 'mall_product', 'mall_order']
  },
  // æ·»åŠ æ–°ç‰ˆæœ¬...
];
```

### æ€§èƒ½è°ƒä¼˜å‚æ•°

åœ¨ `database-performance-tuning.sql` ä¸­è°ƒæ•´MySQLå‚æ•°ï¼š

```sql
-- ç¼“å†²æ± å¤§å°ï¼ˆæ ¹æ®å†…å­˜è°ƒæ•´ï¼‰
SET GLOBAL innodb_buffer_pool_size = 1024*1024*1024; -- 1GB

-- è¿æ¥æ•°é…ç½®
SET GLOBAL max_connections = 200;
SET GLOBAL thread_cache_size = 16;
```

## ğŸ“ˆ ç›‘æ§ä¸å‘Šè­¦

### é›†æˆç›‘æ§

å»ºè®®é›†æˆä»¥ä¸‹ç›‘æ§æ–¹æ¡ˆï¼š

1. **Prometheus + Grafana**ï¼šæ•°æ®åº“æ€§èƒ½ç›‘æ§
2. **Alertmanager**ï¼šå¼‚å¸¸å‘Šè­¦
3. **æ—¥å¿—æ”¶é›†**ï¼šæ“ä½œæ—¥å¿—è®°å½•

### å…³é”®æŒ‡æ ‡

- ğŸ”— æ•°æ®åº“è¿æ¥æ•°
- â±ï¸ æŸ¥è¯¢å“åº”æ—¶é—´
- ğŸ’¾ å†…å­˜ä½¿ç”¨ç‡
- ğŸ“Š è¡¨ç©ºé—´ä½¿ç”¨æƒ…å†µ

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘è§„èŒƒ

1. **ç‰ˆæœ¬ç®¡ç†**ï¼šæ–°å¢åŠŸèƒ½å¿…é¡»åŒ…å«ç‰ˆæœ¬æ›´æ–°
2. **SQLè§„èŒƒ**ï¼šä½¿ç”¨ç»Ÿä¸€çš„å‘½åå’Œç¼–ç è§„èŒƒ
3. **æµ‹è¯•éªŒè¯**ï¼šæ‰€æœ‰è„šæœ¬éœ€åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
4. **æ–‡æ¡£æ›´æ–°**ï¼šåŠŸèƒ½å˜æ›´éœ€åŒæ­¥æ›´æ–°æ–‡æ¡£

### é—®é¢˜åé¦ˆ

é‡åˆ°é—®é¢˜æ—¶è¯·æä¾›ï¼š
- ğŸ” é”™è¯¯æ—¥å¿—
- ğŸ“Š æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯
- âš™ï¸ ç¯å¢ƒé…ç½®ä¿¡æ¯
- ğŸ”„ æ“ä½œæ­¥éª¤æè¿°

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸º MallEco API æ•°æ®åº“ç®¡ç†æ¨¡å—åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ã€‚

---

**æœ€åæ›´æ–°ï¼š2024å¹´12æœˆ**  
**ç»´æŠ¤å›¢é˜Ÿï¼šMallEco å¼€å‘å›¢é˜Ÿ**