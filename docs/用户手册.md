# MallEcoAPI ç”¨æˆ·æ‰‹å†Œ

**ç‰ˆæœ¬**: v3.2  
**æœ€åæ›´æ–°**: 2025å¹´12æœˆ11æ—¥  
**é€‚ç”¨å¯¹è±¡**: ç³»ç»Ÿç®¡ç†å‘˜ã€å¼€å‘äººå‘˜ã€è¿ç»´äººå‘˜ã€æ•°æ®åº“ç®¡ç†å‘˜

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. [APIä½¿ç”¨æŒ‡å—](#apiä½¿ç”¨æŒ‡å—)
4. [ç³»ç»Ÿç®¡ç†](#ç³»ç»Ÿç®¡ç†)
5. [ç›‘æ§è¿ç»´](#ç›‘æ§è¿ç»´)
6. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## ğŸ—ï¸ ç³»ç»Ÿæ¦‚è¿°

### ç³»ç»Ÿæ¶æ„
MallEcoAPIæ˜¯åŸºäºNestJSæ„å»ºçš„ç°ä»£åŒ–ç”µå•†APIå¹³å°ï¼Œé‡‡ç”¨å¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š

- **æ ¸å¿ƒä¸šåŠ¡æ¨¡å—**: äº§å“ç®¡ç†ã€è®¢å•å¤„ç†ã€æ”¯ä»˜ç³»ç»Ÿã€åˆ†é”€ç³»ç»Ÿ
- **å¤šç«¯åˆ†ç¦»æ¨¡å—**: ä¹°å®¶ç«¯ã€å–å®¶ç«¯ã€ç®¡ç†ç«¯
- **æ¶æ„ä¼˜åŒ–æ¨¡å—**: æ€§èƒ½ç›‘æ§ã€ç¼“å­˜ç­–ç•¥ã€å¾®æœåŠ¡ç®¡ç†
- **å®‰å…¨é˜²æŠ¤æ¨¡å—**: è®¤è¯æˆæƒã€å®¡è®¡æ—¥å¿—ã€å®‰å…¨ç›‘æ§
- **æ•°æ®åº“ç®¡ç†æ¨¡å—**: æ•°æ®åº“åˆå§‹åŒ–ã€ç‰ˆæœ¬ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–ã€æ•°æ®è¿ç§»

### æŠ€æœ¯æ ˆ
- **åç«¯æ¡†æ¶**: NestJS + TypeScript
- **æ•°æ®åº“**: MySQL 8.0 + Redis 7.0
- **æœç´¢æœåŠ¡**: Elasticsearch 8.5
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQ
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **ç›‘æ§ç³»ç»Ÿ**: Prometheus + Grafana
- **æ•°æ®åº“ç®¡ç†**: Node.js + MySQLå®¢æˆ·ç«¯ + ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Docker 20.10+
- Docker Compose 2.0+
- è‡³å°‘8GBå†…å­˜
- 50GBå¯ç”¨ç£ç›˜ç©ºé—´

### ä¸€é”®éƒ¨ç½²
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/malleco-api.git
cd malleco-api

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“å¯†ç ç­‰å‚æ•°

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
```

### æ•°æ®åº“åˆå§‹åŒ–
```bash
# è¿›å…¥DBç›®å½•
cd DB

# æ–°é¡¹ç›®åˆå§‹åŒ–ï¼ˆæ¨èï¼‰
node index.js setup

# æˆ–è€…ä½¿ç”¨æ ¸å¿ƒç®¡ç†å™¨
node database-manager.js init
```

### éªŒè¯å®‰è£…
```bash
# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:3000/api/health

# æ£€æŸ¥APIç«¯ç‚¹
curl http://localhost:3000/api/products

# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
node index.js health
```

## ğŸ”Œ APIä½¿ç”¨æŒ‡å—

### è®¤è¯æœºåˆ¶
æ‰€æœ‰APIè¯·æ±‚éƒ½éœ€è¦JWTè®¤è¯ï¼š

```bash
# è·å–è®¿é—®ä»¤ç‰Œ
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"your_password"}'

# ä½¿ç”¨ä»¤ç‰Œè®¿é—®API
curl -X GET http://localhost:3000/api/manager/users \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### APIåŸºç¡€æ ¼å¼
æ‰€æœ‰APIå“åº”éµå¾ªç»Ÿä¸€æ ¼å¼ï¼š

```json
{
  "code": 200,
  "message": "æˆåŠŸ",
  "data": {
    // å…·ä½“ä¸šåŠ¡æ•°æ®
  },
  "timestamp": "2025-12-11T10:30:00.000Z"
}
```

### ä¸»è¦APIç«¯ç‚¹

#### äº§å“ç®¡ç†
```bash
# è·å–äº§å“åˆ—è¡¨
GET /api/products

# åˆ›å»ºæ–°äº§å“
POST /api/products
{
  "name": "å•†å“åç§°",
  "price": 99.99,
  "stock": 100
}

# æœç´¢äº§å“
GET /api/search/products?q=æ‰‹æœº&category=electronics
```

#### è®¢å•ç®¡ç†
```bash
# åˆ›å»ºè®¢å•
POST /api/orders
{
  "productId": 1,
  "quantity": 2,
  "paymentMethod": "wallet"
}

# æŸ¥è¯¢è®¢å•çŠ¶æ€
GET /api/orders/{orderId}
```

#### æ”¯ä»˜ç³»ç»Ÿ
```bash
# é’±åŒ…å……å€¼
POST /api/wallet/recharge
{
  "amount": 100.00,
  "paymentChannel": "alipay"
}

# ä½™é¢æŸ¥è¯¢
GET /api/wallet/balance
```

#### åˆ†é”€ç³»ç»Ÿ
```bash
# ç”³è¯·æˆä¸ºåˆ†é”€å‘˜
POST /api/distribution/apply
{
  "userId": 123,
  "realName": "å¼ ä¸‰"
}

# æŸ¥è¯¢ä½£é‡‘
GET /api/distribution/commission
```

## âš™ï¸ ç³»ç»Ÿç®¡ç†

### ç”¨æˆ·ç®¡ç†
```bash
# åˆ›å»ºç”¨æˆ·
POST /api/manager/users
{
  "username": "newuser",
  "email": "user@example.com",
  "role": "buyer"
}

# ç”¨æˆ·æƒé™ç®¡ç†
PUT /api/manager/users/{userId}/permissions
{
  "permissions": ["product:read", "order:create"]
}
```

### ç³»ç»Ÿé…ç½®
```bash
# è·å–ç³»ç»Ÿé…ç½®
GET /api/system/config

# æ›´æ–°é…ç½®
PUT /api/system/config
{
  "appName": "MallEco",
  "maxLoginAttempts": 5
}
```

### æ•°æ®å¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½
POST /api/system/backup

# æ¢å¤å¤‡ä»½
POST /api/system/restore
{
  "backupId": "backup_20251211"
}
```

### æ•°æ®åº“ç®¡ç†

#### ç»Ÿä¸€ç®¡ç†å…¥å£ï¼ˆæ¨èï¼‰
```bash
# è¿›å…¥DBç›®å½•
cd DB

# æ–°é¡¹ç›®åˆå§‹åŒ–
node index.js setup

# å¥åº·æ£€æŸ¥
node index.js health

# ç‰ˆæœ¬å‡çº§
node index.js upgrade

# æŸ¥çœ‹çŠ¶æ€
node index.js status

# æ€§èƒ½ä¼˜åŒ–
node index.js optimize
```

#### æ ¸å¿ƒç®¡ç†åŠŸèƒ½
```bash
# åŸºç¡€ç®¡ç†
node database-manager.js init      # å®Œæ•´åˆå§‹åŒ–
node database-manager.js update    # ä»…æ›´æ–°ç¼ºå¤±è¡¨
node database-manager.js health    # å¥åº·æ£€æŸ¥

# ç‰ˆæœ¬ç®¡ç†
node database-manager.js version   # ç‰ˆæœ¬å‡çº§
node database-manager.js current   # å½“å‰ç‰ˆæœ¬
node database-manager.js history   # ç‰ˆæœ¬å†å²

# è¾…åŠ©åŠŸèƒ½
node database-manager.js tables    # è¡¨åˆ—è¡¨
node database-manager.js optimize  # æ€§èƒ½ä¼˜åŒ–
```

#### æ•°æ®åº“å¥åº·æ£€æŸ¥é¡¹ç›®
- âœ… æ•°æ®åº“è¿æ¥çŠ¶æ€
- âœ… å…³é”®è¡¨å­˜åœ¨æ€§æ£€æŸ¥ï¼ˆmall_members, mall_product, mall_orderï¼‰
- âœ… è¡¨ç»“æ„å®Œæ•´æ€§æ£€æŸ¥
- âœ… ç‰ˆæœ¬ç®¡ç†è¡¨çŠ¶æ€
- ğŸ“Š å½“å‰æ•°æ®åº“ç‰ˆæœ¬æ£€æµ‹
- ğŸ”„ ç‰ˆæœ¬æ›´æ–°å»ºè®®
- âš ï¸ ç¼ºå¤±è¡¨è­¦å‘Š

#### ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ
å½“å‰æ”¯æŒç‰ˆæœ¬ï¼š
- **1.0.0**: åˆå§‹ç‰ˆæœ¬ - åŸºç¡€è¡¨ç»“æ„
- **1.1.0**: æ€§èƒ½ä¼˜åŒ–ç‰ˆ - ç´¢å¼•å’Œè¡¨ç»“æ„ä¼˜åŒ–

#### æ€§èƒ½ä¼˜åŒ–åŠŸèƒ½
- ğŸ” ç´¢å¼•åˆ†æä¸ä¼˜åŒ–
- ğŸ“Š è¡¨ç»“æ„ä¼˜åŒ–
- âš¡ æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- ğŸ’¾ å­˜å‚¨ä¼˜åŒ–

## ğŸ“Š ç›‘æ§è¿ç»´

### ç³»ç»Ÿç›‘æ§
è®¿é—®ç›‘æ§é¢æ¿ï¼š
- **Grafana**: http://localhost:3001 (admin/your_password)
- **Prometheus**: http://localhost:9090

### å…³é”®ç›‘æ§æŒ‡æ ‡

#### åº”ç”¨æ€§èƒ½æŒ‡æ ‡
- APIå“åº”æ—¶é—´ (< 300ms)
- é”™è¯¯ç‡ (< 0.1%)
- å¹¶å‘ç”¨æˆ·æ•°
- CPU/å†…å­˜ä½¿ç”¨ç‡

#### æ•°æ®åº“æŒ‡æ ‡
- è¿æ¥æ•°
- æŸ¥è¯¢æ€§èƒ½
- é”ç­‰å¾…æ—¶é—´
- ç¼“å­˜å‘½ä¸­ç‡

#### ä¸šåŠ¡æŒ‡æ ‡
- è®¢å•åˆ›å»ºé‡
- æ”¯ä»˜æˆåŠŸç‡
- ç”¨æˆ·æ´»è·ƒåº¦
- å•†å“è½¬åŒ–ç‡

### å‘Šè­¦é…ç½®
ç³»ç»Ÿæ”¯æŒä»¥ä¸‹å‘Šè­¦è§„åˆ™ï¼š

```yaml
# é«˜å¯ç”¨æ€§å‘Šè­¦
- APIé”™è¯¯ç‡ > 1%
- æ•°æ®åº“è¿æ¥å¤±è´¥
- æœåŠ¡ä¸å¯ç”¨è¶…è¿‡5åˆ†é’Ÿ

# æ€§èƒ½å‘Šè­¦
- å¹³å‡å“åº”æ—¶é—´ > 500ms
- CPUä½¿ç”¨ç‡ > 80%
- å†…å­˜ä½¿ç”¨ç‡ > 85%

# ä¸šåŠ¡å‘Šè­¦
- è®¢å•åˆ›å»ºé‡å¼‚å¸¸ä¸‹é™
- æ”¯ä»˜å¤±è´¥ç‡ä¸Šå‡
- ç”¨æˆ·ç™»å½•å¼‚å¸¸
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜è§£å†³

#### æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs app
docker-compose logs mysql

# é‡å¯æœåŠ¡
docker-compose restart app
```

#### æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -h localhost -u root -p

# é‡ç½®æ•°æ®åº“
docker-compose down -v
docker-compose up -d

# ä½¿ç”¨æ•°æ®åº“ç®¡ç†å™¨æ£€æŸ¥
node index.js health
```

#### æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
cat config/.env | grep DB_

# æ‰‹åŠ¨æµ‹è¯•æ•°æ®åº“è¿æ¥
node database-manager.js health

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
node database-manager.js init --verbose

# æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨å†²çª
node database-manager.js tables
```

#### ç‰ˆæœ¬å‡çº§å¤±è´¥
```bash
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬çŠ¶æ€
node index.js status

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
node database-manager.js version

# æ‰‹åŠ¨æ‰§è¡Œç‰ˆæœ¬å‡çº§
node database-manager.js version
```

#### æ€§èƒ½é—®é¢˜
```bash
# æ‰§è¡Œæ€§èƒ½ä¼˜åŒ–
node index.js optimize

# æŸ¥çœ‹è¡¨çŠ¶æ€
node database-manager.js tables

# æ‰‹åŠ¨æ‰§è¡Œä¼˜åŒ–è„šæœ¬
mysql -u root -p < database-performance-tuning.sql
```

#### APIè®¿é—®è¶…æ—¶
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping localhost

# æŸ¥çœ‹NginxçŠ¶æ€
docker-compose logs nginx

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
sudo ufw status
```

### æ€§èƒ½ä¼˜åŒ–

#### æ•°æ®åº“ä¼˜åŒ–
```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_product_category ON products(category);
CREATE INDEX idx_order_status ON orders(status);

-- åˆ†ææ…¢æŸ¥è¯¢
EXPLAIN ANALYZE SELECT * FROM products WHERE price > 100;
```

#### ç¼“å­˜ä¼˜åŒ–
```bash
# æŸ¥çœ‹RedisçŠ¶æ€
redis-cli info

# æ¸…ç†ç¼“å­˜
redis-cli FLUSHALL
```

#### åº”ç”¨ä¼˜åŒ–
```typescript
// å¯ç”¨æŸ¥è¯¢ç¼“å­˜
@Cacheable({ ttl: 300 })
async getProducts() {
  return this.productService.findAll();
}
```

## ğŸ¯ æœ€ä½³å®è·µ

### å®‰å…¨æœ€ä½³å®è·µ
1. **å®šæœŸæ›´æ–°å¯†ç **: æ¯90å¤©æ›´æ¢ä¸€æ¬¡ç³»ç»Ÿå¯†ç 
2. **å¯ç”¨å¤šå› ç´ è®¤è¯**: å…³é”®æ“ä½œå¯ç”¨MFA
3. **é™åˆ¶APIè®¿é—®é¢‘ç‡**: é˜²æ­¢APIæ»¥ç”¨
4. **å®šæœŸå®‰å…¨æ‰«æ**: æ¯æœˆè¿›è¡Œä¸€æ¬¡å®‰å…¨è¯„ä¼°

### æ€§èƒ½æœ€ä½³å®è·µ
1. **ä½¿ç”¨CDN**: é™æ€èµ„æºä½¿ç”¨CDNåŠ é€Ÿ
2. **æ•°æ®åº“åˆ†è¡¨**: å¤§æ•°æ®é‡è¡¨è¿›è¡Œåˆ†è¡¨å¤„ç†
3. **ç¼“å­˜ç­–ç•¥**: åˆç†è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´
4. **å¼‚æ­¥å¤„ç†**: è€—æ—¶æ“ä½œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—

### æ•°æ®åº“ç®¡ç†æœ€ä½³å®è·µ
1. **å®šæœŸå¥åº·æ£€æŸ¥**: æ¯æ—¥æ‰§è¡Œ `node index.js health`
2. **ç‰ˆæœ¬ç®¡ç†**: ä½¿ç”¨ç»Ÿä¸€ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè¿›è¡Œå‡çº§
3. **æ€§èƒ½ä¼˜åŒ–**: æ¯å‘¨æ‰§è¡Œ `node index.js optimize`
4. **å¤‡ä»½ç­–ç•¥**: ç»“åˆç³»ç»Ÿå¤‡ä»½å’Œæ•°æ®åº“å¤‡ä»½
5. **ç›‘æ§å‘Šè­¦**: è®¾ç½®æ•°æ®åº“æ€§èƒ½ç›‘æ§é˜ˆå€¼
6. **æ–‡æ¡£æ›´æ–°**: æ•°æ®åº“å˜æ›´æ—¶åŠæ—¶æ›´æ–°æ–‡æ¡£

### è¿ç»´æœ€ä½³å®è·µ
1. **å®šæœŸå¤‡ä»½**: æ¯å¤©è‡ªåŠ¨å¤‡ä»½å…³é”®æ•°æ®
2. **ç›‘æ§å‘Šè­¦**: è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼
3. **æ—¥å¿—åˆ†æ**: å®šæœŸåˆ†æç³»ç»Ÿæ—¥å¿—
4. **ç‰ˆæœ¬æ§åˆ¶**: ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬ç®¡ç†

### æ•°æ®åº“ç»´æŠ¤è®¡åˆ’

#### æ¯æ—¥ç»´æŠ¤
```bash
# å¥åº·æ£€æŸ¥
node index.js health

# å…³é”®æŒ‡æ ‡ç›‘æ§
node database-manager.js health
```

#### æ¯å‘¨ç»´æŠ¤
```bash
# æ€§èƒ½ä¼˜åŒ–
node index.js optimize

# å¤‡ä»½æ£€æŸ¥
mysqldump -u root -p malleco > backup_$(date +%Y%m%d).sql
```

#### æ¯æœˆç»´æŠ¤
```bash
# ç‰ˆæœ¬æ£€æŸ¥ä¸å‡çº§
node index.js upgrade

# æ•°æ®æ¸…ç†ä¸å½’æ¡£
node database-manager.js version
```

#### å­£åº¦ç»´æŠ¤
```bash
# å®Œæ•´æ€§èƒ½è°ƒä¼˜
mysql -u root -p < database-performance-tuning.sql

# æ•°æ®åº“ç»“æ„å®¡æŸ¥
node database-manager.js tables
```

### å¼€å‘æœ€ä½³å®è·µ
1. **ä»£ç è§„èŒƒ**: éµå¾ªESLintå’ŒPrettierè§„èŒƒ
2. **å•å…ƒæµ‹è¯•**: ä¿æŒ80%ä»¥ä¸Šçš„æµ‹è¯•è¦†ç›–ç‡
3. **APIæ–‡æ¡£**: åŠæ—¶æ›´æ–°APIæ–‡æ¡£
4. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»ä¿¡æ¯
- **æŠ€æœ¯æ”¯æŒé‚®ç®±**: support@malleco.com
- **ç´§æ€¥è”ç³»ç”µè¯**: +86-400-123-4567
- **æ–‡æ¡£ç½‘ç«™**: https://docs.malleco.com

### æœåŠ¡ç­‰çº§åè®®(SLA)
- **å¯ç”¨æ€§**: 99.9%
- **å“åº”æ—¶é—´**: å·¥ä½œæ—¥4å°æ—¶å†…
- **è§£å†³æ—¶é—´**: ä¸¥é‡é—®é¢˜24å°æ—¶å†…

### ç‰ˆæœ¬æ›´æ–°
ç³»ç»Ÿæ¯å­£åº¦å‘å¸ƒä¸€æ¬¡ä¸»è¦ç‰ˆæœ¬æ›´æ–°ï¼Œæ¯æœˆå‘å¸ƒå®‰å…¨è¡¥ä¸ã€‚

---

**é‡è¦æç¤º**: æœ¬æ‰‹å†Œå†…å®¹ä¼šéšç³»ç»Ÿæ›´æ–°è€Œè°ƒæ•´ï¼Œè¯·å®šæœŸè®¿é—®æ–‡æ¡£ç½‘ç«™è·å–æœ€æ–°ç‰ˆæœ¬ã€‚